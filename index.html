<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singh Automation - AI Contract Intelligence</title>
    <style>
        :root {
            --primary: #00ff88;
            --bg: #0a0a0a;
            --card: #141414;
            --border: #2a2a2a;
            --text: #ffffff;
            --muted: #888;
            --hot: #ff4757;
            --warm: #ffa502;
            --cold: #3742fa;
            --go: #00ff88;
            --review: #ffa502;
            --nogo: #ff4757;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Navigation */
        .nav {
            background: linear-gradient(180deg, #1a1a1a 0%, var(--card) 100%);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--bg);
            font-size: 1rem;
        }
        
        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .nav-links {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-link:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary);
        }
        
        .nav-link.active {
            background: var(--primary);
            color: var(--bg);
            border-color: var(--primary);
            font-weight: 600;
        }
        
        .nav-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.8rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.25rem;
        }
        
        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--bg);
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background: #00cc6a;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--card);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: #1f1f1f;
            border-color: var(--primary);
        }
        
        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            flex: 1;
        }
        
        .filter-tab {
            padding: 0.4rem 0.8rem;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--muted);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        
        .filter-tab:hover, .filter-tab.active {
            background: var(--primary);
            color: var(--bg);
            border-color: var(--primary);
        }
        
        /* Source Pills */
        .sources-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .source-pill {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.75rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.75rem;
        }
        
        .source-pill .live {
            color: var(--primary);
            font-weight: 600;
        }
        
        .source-pill .demo {
            color: var(--warm);
            font-weight: 600;
        }
        
        /* Opportunity Grid */
        .opp-grid {
            display: grid;
            gap: 1rem;
        }
        
        .opp-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .opp-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 255, 136, 0.1);
        }
        
        .opp-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            gap: 1rem;
        }
        
        .opp-title {
            font-size: 1rem;
            font-weight: 600;
            line-height: 1.4;
            flex: 1;
        }
        
        .opp-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 50px;
        }
        
        .score-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .score-label {
            font-size: 0.65rem;
            color: var(--muted);
            text-transform: uppercase;
        }
        
        .opp-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.8rem;
            color: var(--muted);
        }
        
        .opp-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .opp-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-bottom: 0.75rem;
        }
        
        .tag {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .tag-qualified { background: rgba(0, 255, 136, 0.2); color: var(--primary); }
        .tag-sbir { background: rgba(255, 165, 2, 0.2); color: var(--warm); }
        .tag-state { background: rgba(55, 66, 250, 0.2); color: var(--cold); }
        .tag-dibbs { background: rgba(255, 71, 87, 0.2); color: var(--hot); }
        .tag-urgent { background: var(--hot); color: white; }
        .tag-setaside { background: rgba(0, 255, 136, 0.15); color: var(--primary); }
        
        .opp-desc {
            font-size: 0.85rem;
            color: var(--muted);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }
        
        .opp-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }
        
        .opp-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.4rem 0.75rem;
            border-radius: 5px;
            font-size: 0.75rem;
            cursor: pointer;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            transition: all 0.2s;
        }
        
        .action-btn:hover { background: rgba(255,255,255,0.1); }
        .action-btn.go { border-color: var(--go); color: var(--go); }
        .action-btn.go:hover { background: var(--go); color: var(--bg); }
        .action-btn.review { border-color: var(--review); color: var(--review); }
        .action-btn.review:hover { background: var(--review); color: var(--bg); }
        .action-btn.nogo { border-color: var(--nogo); color: var(--nogo); }
        .action-btn.nogo:hover { background: var(--nogo); color: white; }
        
        /* Subcontracting Styles */
        .sub-tier {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .sub-tier.hot { background: var(--hot); color: white; }
        .sub-tier.warm { background: var(--warm); color: var(--bg); }
        .sub-tier.cold { background: var(--muted); color: var(--bg); }
        
        .sub-signals {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }
        
        .signal-tag {
            padding: 0.15rem 0.4rem;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 3px;
            font-size: 0.65rem;
            color: var(--primary);
        }
        
        /* Pipeline Page */
        .pipeline-columns {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        
        .pipeline-column {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            min-height: 400px;
        }
        
        .pipeline-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }
        
        .pipeline-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        
        .pipeline-count {
            background: var(--border);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
        }
        
        .pipeline-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .pipeline-item {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.85rem;
        }
        
        .pipeline-item-title {
            font-weight: 600;
            margin-bottom: 0.35rem;
        }
        
        .pipeline-item-meta {
            font-size: 0.75rem;
            color: var(--muted);
        }
        
        .pipeline-empty {
            text-align: center;
            color: var(--muted);
            padding: 2rem;
            font-size: 0.85rem;
        }
        
        /* AI Agent Page */
        .agent-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 1.5rem;
        }
        
        .agent-sidebar {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
        }
        
        .agent-main {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            min-height: 500px;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 0.6rem 0.75rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-hint {
            font-size: 0.75rem;
            color: var(--muted);
            margin-top: 0.35rem;
        }
        
        .proposal-output {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            min-height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: var(--text);
        }
        
        .modal-body {
            padding: 1.25rem;
        }
        
        .modal-section {
            margin-bottom: 1.25rem;
        }
        
        .modal-section-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            padding: 1.25rem;
            border-top: 1px solid var(--border);
        }
        
        /* Outreach Modal */
        .outreach-field {
            margin-bottom: 1rem;
        }
        
        .outreach-label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.35rem;
            color: var(--muted);
        }
        
        .outreach-input {
            width: 100%;
            padding: 0.6rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .outreach-textarea {
            width: 100%;
            min-height: 250px;
            padding: 0.75rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.85rem;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
        }
        
        /* Data source indicator */
        .data-source {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: auto;
        }
        
        .data-source.live { border-color: var(--primary); color: var(--primary); }
        .data-source.demo { border-color: var(--warm); color: var(--warm); }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--muted);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--muted);
        }
        
        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .agent-container {
                grid-template-columns: 1fr;
            }
            
            .pipeline-columns {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .nav-content {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
            }
            
            .stats-bar {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <div class="logo">
                <div class="logo-icon">SA</div>
                <span class="logo-text">SINGH AUTO</span>
            </div>
            
            <div class="nav-links">
                <button class="nav-link active" onclick="showPage('scanner', this)">üì° Scanner</button>
                <button class="nav-link" onclick="showPage('subcontracting', this)">üéØ Subcontracting</button>
                <button class="nav-link" onclick="showPage('pipeline', this)">üìä Pipeline</button>
                <button class="nav-link" onclick="showPage('agent', this)">ü§ñ AI Agent</button>
            </div>
            
            <div class="nav-status">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Ready</span>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <!-- ===================== SCANNER PAGE ===================== -->
        <section id="page-scanner" class="page-section active">
            <!-- Stats -->
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value" id="stat-live">0</div>
                    <div class="stat-label">Live</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-qualified">0</div>
                    <div class="stat-label">Qualified</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-urgent">0</div>
                    <div class="stat-label">Urgent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-value">$0</div>
                    <div class="stat-label">Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-match">0%</div>
                    <div class="stat-label">Avg Match</div>
                </div>
            </div>
            
            <!-- Sources -->
            <div class="sources-row">
                <div class="source-pill">SAM.gov <span class="live">LIVE</span></div>
                <div class="source-pill">SBIR/STTR <span class="live">LIVE</span></div>
                <div class="source-pill">DIBBS <span class="demo">DEMO</span></div>
                <div class="source-pill">CA eProcure <span class="demo">DEMO</span></div>
                <div class="source-pill">MI SIGMA <span class="demo">DEMO</span></div>
                <div class="source-pill">TX SmartBuy <span class="demo">DEMO</span></div>
            </div>
            
            <!-- Controls -->
            <div class="controls">
                <button class="btn btn-primary" onclick="scanOpportunities()">üîÑ Scan All Sources</button>
                
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterOpps('all', this)">All</button>
                    <button class="filter-tab" onclick="filterOpps('federal', this)">Federal</button>
                    <button class="filter-tab" onclick="filterOpps('sbir', this)">SBIR</button>
                    <button class="filter-tab" onclick="filterOpps('state', this)">State</button>
                    <button class="filter-tab" onclick="filterOpps('dibbs', this)">DIBBS</button>
                    <button class="filter-tab" onclick="filterOpps('qualified', this)">‚úì Qualified</button>
                </div>
                
                <div class="data-source demo" id="scanner-source">üìä Demo Data</div>
            </div>
            
            <!-- Opportunity List -->
            <div class="opp-grid" id="scanner-list">
                <div class="empty-state">
                    <h3>üì° Ready to Scan</h3>
                    <p>Click "Scan All Sources" to load opportunities</p>
                </div>
            </div>
        </section>
        
        <!-- ===================== SUBCONTRACTING PAGE ===================== -->
        <section id="page-subcontracting" class="page-section">
            <!-- Stats -->
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value" id="sub-total">0</div>
                    <div class="stat-label">Total Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sub-hot">0</div>
                    <div class="stat-label">üî• Hot Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sub-warm">0</div>
                    <div class="stat-label">üå°Ô∏è Warm Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sub-value">$0</div>
                    <div class="stat-label">Total Value</div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="controls">
                <button class="btn btn-primary" onclick="loadSubcontracting()">üîÑ Refresh</button>
                
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterSubs('all', this)">All</button>
                    <button class="filter-tab" onclick="filterSubs('hot', this)">üî• Hot</button>
                    <button class="filter-tab" onclick="filterSubs('warm', this)">üå°Ô∏è Warm</button>
                </div>
                
                <div class="data-source demo" id="sub-source">üìä Demo Data</div>
            </div>
            
            <!-- Subcontracting List -->
            <div class="opp-grid" id="sub-list">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading subcontracting opportunities...</p>
                </div>
            </div>
        </section>
        
        <!-- ===================== PIPELINE PAGE ===================== -->
        <section id="page-pipeline" class="page-section">
            <div class="stats-bar" style="margin-bottom: 1.5rem;">
                <div class="stat-card">
                    <div class="stat-value" style="color: var(--go);" id="pipe-go">0</div>
                    <div class="stat-label">GO</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: var(--review);" id="pipe-review">0</div>
                    <div class="stat-label">Review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: var(--nogo);" id="pipe-nogo">0</div>
                    <div class="stat-label">No-Go</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pipe-value">$0</div>
                    <div class="stat-label">Pipeline Value</div>
                </div>
            </div>
            
            <div class="pipeline-columns">
                <div class="pipeline-column">
                    <div class="pipeline-header">
                        <div class="pipeline-title">
                            <span style="color: var(--go);">üü¢</span> GO
                        </div>
                        <span class="pipeline-count" id="go-count">0</span>
                    </div>
                    <div class="pipeline-items" id="go-items">
                        <div class="pipeline-empty">Move opportunities here from Scanner</div>
                    </div>
                </div>
                
                <div class="pipeline-column">
                    <div class="pipeline-header">
                        <div class="pipeline-title">
                            <span style="color: var(--review);">üü°</span> Review
                        </div>
                        <span class="pipeline-count" id="review-count">0</span>
                    </div>
                    <div class="pipeline-items" id="review-items">
                        <div class="pipeline-empty">Opportunities needing evaluation</div>
                    </div>
                </div>
                
                <div class="pipeline-column">
                    <div class="pipeline-header">
                        <div class="pipeline-title">
                            <span style="color: var(--nogo);">üî¥</span> No-Go
                        </div>
                        <span class="pipeline-count" id="nogo-count">0</span>
                    </div>
                    <div class="pipeline-items" id="nogo-items">
                        <div class="pipeline-empty">Declined opportunities</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ===================== AI AGENT PAGE ===================== -->
        <section id="page-agent" class="page-section">
            <div class="agent-container">
                <div class="agent-sidebar">
                    <h3 style="margin-bottom: 1.25rem;">ü§ñ AI Proposal Generator</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Claude API Key</label>
                        <input type="password" class="form-input" id="api-key" placeholder="sk-ant-...">
                        <p class="form-hint">Get from <a href="https://console.anthropic.com" target="_blank" style="color: var(--primary);">console.anthropic.com</a></p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Select Opportunity</label>
                        <select class="form-select" id="opp-select">
                            <option value="">-- Scan first to select --</option>
                        </select>
                        <p class="form-hint">Choose from GO recommendations</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Output Type</label>
                        <select class="form-select" id="output-type">
                            <option value="capability">Capability Statement</option>
                            <option value="technical">Technical Volume</option>
                            <option value="cover">Cover Letter</option>
                            <option value="teaming">Teaming Email</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;" onclick="generateProposal()">
                        üöÄ Generate Proposal
                    </button>
                    
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" style="flex: 1;" onclick="downloadWord()">üìÑ Word</button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="downloadTxt()">üìù TXT</button>
                    </div>
                </div>
                
                <div class="agent-main">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Generated Output</h3>
                        <button class="btn btn-secondary" onclick="copyOutput()">üìã Copy</button>
                    </div>
                    <div class="proposal-output" id="proposal-output">
Click "Generate Proposal" to create AI-powered content.

Supports:
‚Ä¢ Capability Statements
‚Ä¢ Technical Volumes  
‚Ä¢ Cover Letters
‚Ä¢ Teaming Emails

Your Singh Automation credentials:
‚Ä¢ CAGE: 86VF7
‚Ä¢ UEI: GJ1DPYQ3X8K5
‚Ä¢ FANUC ASI & UR CSP Certified
‚Ä¢ NAICS: 333249, 541330, 541512, 541715
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Detail Modal -->
    <div class="modal-overlay" id="detail-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Opportunity Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Populated dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn action-btn nogo" onclick="pipelineAction('nogo')">No-Go</button>
                <button class="btn action-btn review" onclick="pipelineAction('review')">Review</button>
                <button class="btn action-btn go" onclick="pipelineAction('go')">GO</button>
            </div>
        </div>
    </div>
    
    <!-- Outreach Modal -->
    <div class="modal-overlay" id="outreach-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">üìß Draft Outreach Email</h2>
                <button class="modal-close" onclick="closeOutreachModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="outreach-field">
                    <label class="outreach-label">To:</label>
                    <input type="text" class="outreach-input" id="outreach-to" readonly>
                </div>
                <div class="outreach-field">
                    <label class="outreach-label">Subject:</label>
                    <input type="text" class="outreach-input" id="outreach-subject">
                </div>
                <div class="outreach-field">
                    <label class="outreach-label">Body:</label>
                    <textarea class="outreach-textarea" id="outreach-body"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeOutreachModal()">Close</button>
                <button class="btn btn-secondary" onclick="copyOutreach()">üìã Copy to Clipboard</button>
                <button class="btn btn-primary" onclick="openInEmail()">üìß Open in Email</button>
            </div>
        </div>
    </div>
    
    <script>
        // ===================== STATE =====================
        let opportunities = [];
        let subOpportunities = [];
        let currentFilter = 'all';
        let currentSubFilter = 'all';
        let selectedOpp = null;
        let selectedSubOpp = null;
        let pipeline = { go: [], review: [], nogo: [] };
        
        // Load pipeline from localStorage
        try {
            const saved = localStorage.getItem('singh-pipeline');
            if (saved) pipeline = JSON.parse(saved);
        } catch(e) {}
        
        // Singh company profile
        const SINGH = {
            name: 'Singh Automation',
            cage: '86VF7',
            uei: 'GJ1DPYQ3X8K5',
            naics: ['333249', '541330', '541512', '541715', '238210', '333922'],
            certs: ['Small Business', 'MBE', 'WBENC', 'FANUC ASI', 'UR CSP'],
            hq: 'Kalamazoo, MI',
            branch: 'Irvine, CA',
            phone: '(269) 381-6236',
            website: 'www.singhautomation.com'
        };
        
        // ===================== NAVIGATION =====================
        function showPage(page, btn) {
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + page).classList.add('active');
            
            if (page === 'pipeline') updatePipelineUI();
            if (page === 'subcontracting' && subOpportunities.length === 0) loadSubcontracting();
        }
        
        // ===================== SCANNER =====================
        async function scanOpportunities() {
            const list = document.getElementById('scanner-list');
            list.innerHTML = '<div class="loading"><div class="spinner"></div><p>Scanning sources...</p></div>';
            
            // Try to fetch from live API first
            try {
                const response = await fetch('/api/opportunities');
                if (response.ok) {
                    const data = await response.json();
                    if (data.opportunities && data.opportunities.length > 0) {
                        opportunities = data.opportunities;
                        document.getElementById('scanner-source').className = 'data-source live';
                        document.getElementById('scanner-source').innerHTML = 'üü¢ Live Data';
                        renderOpportunities();
                        return;
                    }
                }
            } catch(e) {
                console.log('API unavailable, using demo data');
            }
            
            // Fallback to demo data
            opportunities = getDemoOpportunities();
            document.getElementById('scanner-source').className = 'data-source demo';
            document.getElementById('scanner-source').innerHTML = 'üìä Demo Data';
            renderOpportunities();
        }
        
        function getDemoOpportunities() {
            return [
                {
                    id: 'SAM-001',
                    title: 'Robotic Welding System Integration - Army Depot',
                    source: 'federal',
                    agency: 'U.S. Army',
                    value: 850000,
                    deadline: '2025-01-15',
                    naics: '333249',
                    setAside: 'Small Business',
                    match: 94,
                    qualified: true,
                    urgent: true,
                    description: 'Integration of automated robotic welding systems for vehicle maintenance depot. Requires FANUC or equivalent robotic systems.',
                    link: 'https://sam.gov/opp/example1'
                },
                {
                    id: 'SAM-002',
                    title: 'AI Vision Inspection System - Navy Shipyard',
                    source: 'federal',
                    agency: 'U.S. Navy',
                    value: 1200000,
                    deadline: '2025-02-01',
                    naics: '541512',
                    setAside: 'Small Business',
                    match: 91,
                    qualified: true,
                    urgent: false,
                    description: 'Development and deployment of AI-powered visual inspection systems for hull integrity assessment.',
                    link: 'https://sam.gov/opp/example2'
                },
                {
                    id: 'SBIR-001',
                    title: 'Advanced Manufacturing Automation Research',
                    source: 'sbir',
                    agency: 'DoD',
                    value: 250000,
                    deadline: '2025-01-30',
                    naics: '541715',
                    setAside: 'SBIR Phase I',
                    match: 88,
                    qualified: true,
                    urgent: false,
                    description: 'Research into next-generation robotic automation for defense manufacturing facilities.',
                    link: 'https://sbir.gov/example1'
                },
                {
                    id: 'SAM-003',
                    title: 'Warehouse Automation System - GSA',
                    source: 'federal',
                    agency: 'GSA',
                    value: 450000,
                    deadline: '2025-01-20',
                    naics: '333922',
                    setAside: 'Total Small Business',
                    match: 85,
                    qualified: true,
                    urgent: true,
                    description: 'Material handling and warehouse automation system for federal distribution center.',
                    link: 'https://sam.gov/opp/example3'
                },
                {
                    id: 'CA-001',
                    title: 'CalTrans Robotic Inspection Equipment',
                    source: 'state',
                    agency: 'CalTrans',
                    value: 320000,
                    deadline: '2025-02-15',
                    naics: '541330',
                    setAside: 'SB/DVBE',
                    match: 78,
                    qualified: true,
                    urgent: false,
                    description: 'Procurement of robotic systems for highway infrastructure inspection.',
                    link: 'https://caleprocure.ca.gov/example1'
                },
                {
                    id: 'DIBBS-001',
                    title: 'Robot Arm Replacement Parts - NSN 3439-01-XXX',
                    source: 'dibbs',
                    agency: 'DLA',
                    value: 45000,
                    deadline: '2025-01-10',
                    naics: '333249',
                    setAside: 'Open',
                    match: 72,
                    qualified: false,
                    urgent: true,
                    description: 'Replacement servo motors and grippers for existing robotic systems.',
                    link: 'https://dibbs.bsm.dla.mil/example1'
                },
                {
                    id: 'MI-001',
                    title: 'Michigan Manufacturing Automation Grant',
                    source: 'state',
                    agency: 'MEDC',
                    value: 150000,
                    deadline: '2025-03-01',
                    naics: '541512',
                    setAside: 'State Grant',
                    match: 82,
                    qualified: true,
                    urgent: false,
                    description: 'Grant funding for advanced manufacturing automation projects in Michigan.',
                    link: 'https://michigan.gov/medc/example1'
                },
                {
                    id: 'SBIR-002',
                    title: 'Autonomous Mobile Robot Navigation',
                    source: 'sbir',
                    agency: 'NSF',
                    value: 275000,
                    deadline: '2025-02-20',
                    naics: '541715',
                    setAside: 'SBIR Phase I',
                    match: 86,
                    qualified: true,
                    urgent: false,
                    description: 'Development of advanced navigation systems for industrial AMRs.',
                    link: 'https://sbir.gov/example2'
                }
            ];
        }
        
        function renderOpportunities() {
            const list = document.getElementById('scanner-list');
            let filtered = opportunities;
            
            if (currentFilter !== 'all') {
                if (currentFilter === 'qualified') {
                    filtered = opportunities.filter(o => o.qualified);
                } else {
                    filtered = opportunities.filter(o => o.source === currentFilter);
                }
            }
            
            // Update stats
            document.getElementById('stat-live').textContent = opportunities.filter(o => ['federal', 'sbir'].includes(o.source)).length;
            document.getElementById('stat-total').textContent = opportunities.length;
            document.getElementById('stat-qualified').textContent = opportunities.filter(o => o.qualified).length;
            document.getElementById('stat-urgent').textContent = opportunities.filter(o => o.urgent).length;
            const totalValue = opportunities.reduce((sum, o) => sum + o.value, 0);
            document.getElementById('stat-value').textContent = '$' + (totalValue / 1000000).toFixed(1) + 'M';
            const avgMatch = opportunities.length ? Math.round(opportunities.reduce((sum, o) => sum + o.match, 0) / opportunities.length) : 0;
            document.getElementById('stat-match').textContent = avgMatch + '%';
            
            // Update GO dropdown
            const select = document.getElementById('opp-select');
            select.innerHTML = '<option value="">-- Select Opportunity --</option>';
            opportunities.filter(o => o.qualified).forEach((o, i) => {
                select.innerHTML += `<option value="${i}">${o.title.substring(0, 50)}...</option>`;
            });
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>No Opportunities Found</h3><p>Try adjusting your filters</p></div>';
                return;
            }
            
            list.innerHTML = filtered.map((opp, idx) => `
                <div class="opp-card" onclick="showDetail(${opportunities.indexOf(opp)})">
                    <div class="opp-header">
                        <div class="opp-title">${opp.title}</div>
                        <div class="opp-score">
                            <div class="score-value">${opp.match}%</div>
                            <div class="score-label">Match</div>
                        </div>
                    </div>
                    <div class="opp-meta">
                        <span>üèõÔ∏è ${opp.agency}</span>
                        <span>üí∞ $${(opp.value / 1000).toFixed(0)}K</span>
                        <span>üìÖ ${opp.deadline}</span>
                        <span>üìã ${opp.naics}</span>
                    </div>
                    <div class="opp-tags">
                        ${opp.qualified ? '<span class="tag tag-qualified">‚úì Qualified</span>' : ''}
                        ${opp.urgent ? '<span class="tag tag-urgent">‚ö° Urgent</span>' : ''}
                        ${opp.source === 'sbir' ? '<span class="tag tag-sbir">SBIR</span>' : ''}
                        ${opp.source === 'state' ? '<span class="tag tag-state">State</span>' : ''}
                        ${opp.source === 'dibbs' ? '<span class="tag tag-dibbs">DIBBS</span>' : ''}
                        ${opp.setAside ? '<span class="tag tag-setaside">' + opp.setAside + '</span>' : ''}
                    </div>
                    <div class="opp-desc">${opp.description.substring(0, 150)}...</div>
                    <div class="opp-footer">
                        <span style="font-size: 0.75rem; color: var(--muted);">ID: ${opp.id}</span>
                        <div class="opp-actions">
                            <button class="action-btn nogo" onclick="event.stopPropagation(); quickAction(${opportunities.indexOf(opp)}, 'nogo')">No-Go</button>
                            <button class="action-btn review" onclick="event.stopPropagation(); quickAction(${opportunities.indexOf(opp)}, 'review')">Review</button>
                            <button class="action-btn go" onclick="event.stopPropagation(); quickAction(${opportunities.indexOf(opp)}, 'go')">GO</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function filterOpps(filter, btn) {
            currentFilter = filter;
            document.querySelectorAll('#page-scanner .filter-tab').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            renderOpportunities();
        }
        
        function showDetail(idx) {
            selectedOpp = opportunities[idx];
            const opp = selectedOpp;
            
            document.getElementById('modal-title').textContent = opp.title;
            document.getElementById('modal-body').innerHTML = `
                <div class="modal-section">
                    <div class="modal-section-title">Overview</div>
                    <p><strong>Agency:</strong> ${opp.agency}</p>
                    <p><strong>Value:</strong> $${opp.value.toLocaleString()}</p>
                    <p><strong>Deadline:</strong> ${opp.deadline}</p>
                    <p><strong>NAICS:</strong> ${opp.naics}</p>
                    <p><strong>Set-Aside:</strong> ${opp.setAside || 'None'}</p>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Match Analysis</div>
                    <p><strong>Match Score:</strong> <span style="color: var(--primary); font-weight: bold;">${opp.match}%</span></p>
                    <p><strong>Qualified:</strong> ${opp.qualified ? '‚úÖ Yes' : '‚ùå No'}</p>
                    <p><strong>NAICS Match:</strong> ${SINGH.naics.includes(opp.naics) ? '‚úÖ Direct' : '‚ö†Ô∏è Related'}</p>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Description</div>
                    <p>${opp.description}</p>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Links</div>
                    <p><a href="${opp.link}" target="_blank" style="color: var(--primary);">View Original Posting ‚Üí</a></p>
                </div>
            `;
            
            document.getElementById('detail-modal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('detail-modal').classList.remove('active');
            selectedOpp = null;
        }
        
        function quickAction(idx, action) {
            const opp = opportunities[idx];
            addToPipeline(opp, action);
        }
        
        function pipelineAction(action) {
            if (selectedOpp) {
                addToPipeline(selectedOpp, action);
                closeModal();
            }
        }
        
        function addToPipeline(opp, status) {
            // Remove from other columns
            ['go', 'review', 'nogo'].forEach(s => {
                pipeline[s] = pipeline[s].filter(o => o.id !== opp.id);
            });
            
            // Add to new column
            pipeline[status].push({
                id: opp.id,
                title: opp.title,
                value: opp.value,
                deadline: opp.deadline,
                agency: opp.agency
            });
            
            savePipeline();
            updatePipelineUI();
        }
        
        function savePipeline() {
            localStorage.setItem('singh-pipeline', JSON.stringify(pipeline));
        }
        
        function updatePipelineUI() {
            ['go', 'review', 'nogo'].forEach(status => {
                const items = pipeline[status];
                const container = document.getElementById(status + '-items');
                document.getElementById(status + '-count').textContent = items.length;
                
                if (items.length === 0) {
                    container.innerHTML = '<div class="pipeline-empty">No opportunities</div>';
                } else {
                    container.innerHTML = items.map(item => `
                        <div class="pipeline-item">
                            <div class="pipeline-item-title">${item.title.substring(0, 50)}...</div>
                            <div class="pipeline-item-meta">
                                ${item.agency} ‚Ä¢ $${(item.value/1000).toFixed(0)}K ‚Ä¢ Due: ${item.deadline}
                            </div>
                        </div>
                    `).join('');
                }
            });
            
            // Update stats
            document.getElementById('pipe-go').textContent = pipeline.go.length;
            document.getElementById('pipe-review').textContent = pipeline.review.length;
            document.getElementById('pipe-nogo').textContent = pipeline.nogo.length;
            
            const pipeValue = pipeline.go.reduce((sum, o) => sum + o.value, 0);
            document.getElementById('pipe-value').textContent = '$' + (pipeValue / 1000000).toFixed(2) + 'M';
        }
        
        // ===================== SUBCONTRACTING =====================
        async function loadSubcontracting() {
            const list = document.getElementById('sub-list');
            list.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading opportunities...</p></div>';
            
            try {
                const response = await fetch('/api/subcontracting');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.opportunities && data.opportunities.length > 0) {
                        subOpportunities = data.opportunities;
                        document.getElementById('sub-source').className = 'data-source live';
                        document.getElementById('sub-source').innerHTML = 'üü¢ Live Data';
                        renderSubOpportunities();
                        return;
                    }
                }
            } catch(e) {
                console.log('Subcontracting API unavailable, using demo');
            }
            
            // Fallback to demo
            subOpportunities = getSubDemoData();
            document.getElementById('sub-source').className = 'data-source demo';
            document.getElementById('sub-source').innerHTML = 'üìä Demo Data';
            renderSubOpportunities();
        }
        
        function getSubDemoData() {
            return [
                {
                    id: 'SUB-001',
                    prime: 'Turner Construction',
                    award_amount: 8200000,
                    agency: 'Army Corps of Engineers',
                    description: 'Military base modernization with automated material handling systems',
                    location: 'Fort Liberty, NC',
                    naics: '236220',
                    match_score: 87,
                    tier: 'hot',
                    signals: ['automation scope', 'material handling', 'DoD prime'],
                    contact: { email: 'subcontracting@turnerconstruction.com', portal: 'https://www.turnerconstruction.com/subcontractors' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_W912DY24C0001'
                },
                {
                    id: 'SUB-002',
                    prime: 'Hensel Phelps',
                    award_amount: 12400000,
                    agency: 'Department of Veterans Affairs',
                    description: 'VA hospital renovation including robotic pharmacy and logistics systems',
                    location: 'San Diego, CA',
                    naics: '236220',
                    match_score: 84,
                    tier: 'hot',
                    signals: ['robotic pharmacy', 'logistics automation', 'healthcare'],
                    contact: { email: 'suppliers@henselphelps.com', portal: 'https://www.henselphelps.com/subcontractors/' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_36C24624C0002'
                },
                {
                    id: 'SUB-003',
                    prime: 'Clark Construction',
                    award_amount: 6800000,
                    agency: 'GSA',
                    description: 'Federal building upgrade with smart building automation',
                    location: 'Chicago, IL',
                    naics: '236220',
                    match_score: 78,
                    tier: 'hot',
                    signals: ['building automation', 'smart systems', 'controls'],
                    contact: { email: 'subcontractors@clarkconstruction.com', portal: 'https://www.clarkconstruction.com/subcontractors' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_GS09P24BTC0003'
                },
                {
                    id: 'SUB-004',
                    prime: 'Leidos',
                    award_amount: 5700000,
                    agency: 'DoD',
                    description: 'Defense logistics automation and AI systems integration',
                    location: 'Huntsville, AL',
                    naics: '541512',
                    match_score: 62,
                    tier: 'warm',
                    signals: ['AI integration', 'logistics', 'defense'],
                    contact: { email: 'small.business@leidos.com', portal: 'https://www.leidos.com/suppliers' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_W58RGZ24C0004'
                },
                {
                    id: 'SUB-005',
                    prime: 'Jacobs Engineering',
                    award_amount: 4800000,
                    agency: 'NASA',
                    description: 'Facility systems integration for launch complex',
                    location: 'Cape Canaveral, FL',
                    naics: '541330',
                    match_score: 58,
                    tier: 'warm',
                    signals: ['systems integration', 'NASA', 'facility automation'],
                    contact: { email: 'supplier.diversity@jacobs.com', portal: 'https://www.jacobs.com/suppliers' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_NNK24MA0005'
                },
                {
                    id: 'SUB-006',
                    prime: 'KBR Inc',
                    award_amount: 6100000,
                    agency: 'Army',
                    description: 'Base infrastructure modernization project',
                    location: 'Fort Hood, TX',
                    naics: '541330',
                    match_score: 55,
                    tier: 'warm',
                    signals: ['infrastructure', 'modernization', 'DoD'],
                    contact: { email: 'supplierdiversity@kbr.com', portal: 'https://www.kbr.com/en/about-us/suppliers' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_W911KB24C0006'
                },
                {
                    id: 'SUB-007',
                    prime: 'AECOM',
                    award_amount: 3200000,
                    agency: 'Air Force',
                    description: 'Hangar facility improvements',
                    location: 'Edwards AFB, CA',
                    naics: '236220',
                    match_score: 42,
                    tier: 'cold',
                    signals: ['facility', 'Air Force'],
                    contact: { email: 'suppliers@aecom.com', portal: 'https://aecom.com/about-aecom/suppliers/' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_FA930824C0007'
                },
                {
                    id: 'SUB-008',
                    prime: 'Parsons Corporation',
                    award_amount: 5200000,
                    agency: 'DHS',
                    description: 'Border security technology systems',
                    location: 'El Paso, TX',
                    naics: '541512',
                    match_score: 38,
                    tier: 'cold',
                    signals: ['security systems', 'technology'],
                    contact: { email: 'suppliers@parsons.com', portal: 'https://www.parsons.com/suppliers/' },
                    contract_link: 'https://usaspending.gov/award/CONT_AWD_HSBP1024C0008'
                }
            ];
        }
        
        function renderSubOpportunities() {
            const list = document.getElementById('sub-list');
            let filtered = subOpportunities;
            
            if (currentSubFilter !== 'all') {
                filtered = subOpportunities.filter(o => o.tier === currentSubFilter);
            }
            
            // Update stats
            document.getElementById('sub-total').textContent = subOpportunities.length;
            document.getElementById('sub-hot').textContent = subOpportunities.filter(o => o.tier === 'hot').length;
            document.getElementById('sub-warm').textContent = subOpportunities.filter(o => o.tier === 'warm').length;
            const totalValue = subOpportunities.reduce((sum, o) => sum + o.award_amount, 0);
            document.getElementById('sub-value').textContent = '$' + (totalValue / 1000000).toFixed(1) + 'M';
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>No Opportunities Found</h3><p>Try adjusting your filters</p></div>';
                return;
            }
            
            list.innerHTML = filtered.map((opp, idx) => `
                <div class="opp-card">
                    <div class="opp-header">
                        <div class="opp-title">${opp.prime}</div>
                        <div class="opp-score">
                            <div class="score-value">${opp.match_score}%</div>
                            <div class="score-label">Match</div>
                        </div>
                    </div>
                    <div class="opp-meta">
                        <span>üèõÔ∏è ${opp.agency}</span>
                        <span>üí∞ $${(opp.award_amount / 1000000).toFixed(1)}M</span>
                        <span>üìç ${opp.location}</span>
                        <span>üìã ${opp.naics}</span>
                    </div>
                    <div class="opp-tags">
                        <span class="sub-tier ${opp.tier}">${opp.tier.toUpperCase()}</span>
                    </div>
                    <div class="opp-desc">${opp.description}</div>
                    <div class="sub-signals">
                        ${opp.signals.map(s => `<span class="signal-tag">${s}</span>`).join('')}
                    </div>
                    <div class="opp-footer">
                        <a href="${opp.contract_link}" target="_blank" style="font-size: 0.75rem; color: var(--primary);">View on USASpending ‚Üí</a>
                        <div class="opp-actions">
                            <button class="action-btn" onclick="showSubOutreach(${subOpportunities.indexOf(opp)})">üìß Draft Outreach</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function filterSubs(filter, btn) {
            currentSubFilter = filter;
            document.querySelectorAll('#page-subcontracting .filter-tab').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            renderSubOpportunities();
        }
        
        function showSubOutreach(idx) {
            selectedSubOpp = subOpportunities[idx];
            const opp = selectedSubOpp;
            
            const email = generateOutreachEmail(opp);
            
            document.getElementById('outreach-to').value = opp.contact?.email || `subcontracting@${opp.prime.toLowerCase().replace(/\s+/g, '')}.com`;
            document.getElementById('outreach-subject').value = `Singh Automation - Subcontracting Inquiry: ${opp.agency} Project`;
            document.getElementById('outreach-body').value = email;
            
            document.getElementById('outreach-modal').classList.add('active');
        }
        
        function generateOutreachEmail(opp) {
            return `Dear ${opp.prime} Team,

I noticed your company was recently awarded a contract with ${opp.agency} involving ${opp.description.toLowerCase()}.

Singh Automation is a FANUC and Universal Robots authorized integrator specializing in industrial robotics and automation systems. If your team needs support executing the robotics, automation, or vision systems portion of this contract, we'd welcome the opportunity to discuss teaming.

Our qualifications:
‚Ä¢ FANUC Authorized System Integrator (ASI)
‚Ä¢ Universal Robots Certified System Partner (CSP)
‚Ä¢ CAGE Code: ${SINGH.cage} | UEI: ${SINGH.uei}
‚Ä¢ Certified Small Business, MBE, WBENC
‚Ä¢ NAICS: ${SINGH.naics.join(', ')}

We have facilities in both Michigan and California and can mobilize quickly for projects nationwide.

Would you be available for a brief call this week to explore potential collaboration?

Best regards,

Singh Automation
${SINGH.website}
${SINGH.phone}
2400 E Cork Street, Kalamazoo, MI 49001`;
        }
        
        function closeOutreachModal() {
            document.getElementById('outreach-modal').classList.remove('active');
            selectedSubOpp = null;
        }
        
        function copyOutreach() {
            const subject = document.getElementById('outreach-subject').value;
            const body = document.getElementById('outreach-body').value;
            const text = `Subject: ${subject}\n\n${body}`;
            navigator.clipboard.writeText(text).then(() => {
                alert('Email copied to clipboard!');
            });
        }
        
        function openInEmail() {
            const to = document.getElementById('outreach-to').value;
            const subject = encodeURIComponent(document.getElementById('outreach-subject').value);
            const body = encodeURIComponent(document.getElementById('outreach-body').value);
            window.open(`mailto:${to}?subject=${subject}&body=${body}`, '_blank');
        }
        
        // ===================== AI AGENT =====================
        async function generateProposal() {
            const apiKey = document.getElementById('api-key').value;
            const oppIdx = document.getElementById('opp-select').value;
            const outputType = document.getElementById('output-type').value;
            const output = document.getElementById('proposal-output');
            
            if (!apiKey) {
                output.textContent = '‚ö†Ô∏è Please enter your Claude API key to generate proposals.';
                return;
            }
            
            if (!oppIdx && opportunities.length === 0) {
                output.textContent = '‚ö†Ô∏è Please scan for opportunities first, then select one.';
                return;
            }
            
            const opp = oppIdx ? opportunities[oppIdx] : opportunities[0];
            
            output.textContent = 'üîÑ Generating proposal...';
            
            const prompts = {
                capability: `Generate a capability statement for Singh Automation responding to this opportunity:\n\nTitle: ${opp.title}\nAgency: ${opp.agency}\nNAICS: ${opp.naics}\nDescription: ${opp.description}\n\nCompany Info:\n- CAGE: ${SINGH.cage}\n- UEI: ${SINGH.uei}\n- Certifications: ${SINGH.certs.join(', ')}\n- NAICS: ${SINGH.naics.join(', ')}\n- Specialties: FANUC & UR Robotics Integration, AI Vision Systems, Warehouse Automation`,
                technical: `Write a technical approach section for a proposal responding to:\n\n${opp.title}\n\n${opp.description}\n\nFocus on Singh Automation's capabilities in robotics integration, AI vision systems, and automation.`,
                cover: `Write a cover letter for Singh Automation's proposal to:\n\nAgency: ${opp.agency}\nProject: ${opp.title}\nValue: $${opp.value.toLocaleString()}\n\nHighlight our FANUC ASI and UR CSP certifications.`,
                teaming: `Write a teaming inquiry email to a prime contractor about:\n\n${opp.title}\n\nSingh Automation wants to offer robotics/automation subcontracting support.`
            };
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{ role: 'user', content: prompts[outputType] }]
                    })
                });
                
                if (!response.ok) {
                    const err = await response.text();
                    output.textContent = '‚ùå API Error: ' + err;
                    return;
                }
                
                const data = await response.json();
                output.textContent = data.content[0].text;
            } catch(e) {
                output.textContent = '‚ùå Error: ' + e.message;
            }
        }
        
        function downloadWord() {
            const content = document.getElementById('proposal-output').textContent;
            // Simple approach - download as .doc (Word can open)
            const blob = new Blob([content], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'proposal.doc';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function downloadTxt() {
            const content = document.getElementById('proposal-output').textContent;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'proposal.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function copyOutput() {
            const content = document.getElementById('proposal-output').textContent;
            navigator.clipboard.writeText(content).then(() => {
                alert('Copied to clipboard!');
            });
        }
        
        // ===================== INIT =====================
        updatePipelineUI();
        
        // Auto-load subcontracting when that page is shown
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize
        });
    </script>
</body>
</html>
