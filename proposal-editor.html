<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proposal Editor | Singh Automation</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: linear-gradient(180deg, #0a0a0f 0%, #0f0f18 100%);
      color: #e5e5e5;
      min-height: 100vh;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: rgba(0,0,0,0.6);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(20px);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .back-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: #888;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s;
    }

    .back-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }

    .header-title h1 {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-title p {
      font-size: 11px;
      color: #666;
      margin-top: 2px;
    }

    .badge {
      background: rgba(234,179,8,0.15);
      color: #fbbf24;
      padding: 3px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
    }

    .badge.pro {
      background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(59,130,246,0.2));
      color: #a78bfa;
      border: 1px solid rgba(139,92,246,0.3);
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.15);
      color: #ccc;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover { background: rgba(255,255,255,0.1); color: #fff; }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      border: none;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(34,197,94,0.3);
    }

    .btn-ai {
      background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(99,102,241,0.2));
      border: 1px solid rgba(139,92,246,0.4);
      color: #a78bfa;
    }

    /* Opportunity Selector */
    .opportunity-bar {
      background: rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .opportunity-bar label {
      font-size: 12px;
      color: #888;
      font-weight: 500;
    }

    .opportunity-select {
      flex: 1;
      min-width: 300px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-family: inherit;
      cursor: pointer;
    }

    .opportunity-select option {
      background: #1a1a1a;
      color: #fff;
    }

    .opp-meta {
      display: flex;
      gap: 20px;
      font-size: 12px;
    }

    .opp-meta span {
      color: #888;
    }

    .opp-meta strong {
      color: #60a5fa;
    }

    /* Volume Tabs */
    .volume-tabs {
      display: flex;
      background: rgba(0,0,0,0.2);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      overflow-x: auto;
    }

    .volume-tab {
      padding: 14px 24px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #666;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      font-family: inherit;
      white-space: nowrap;
      transition: all 0.15s;
    }

    .volume-tab:hover { color: #999; }

    .volume-tab.active {
      background: rgba(255,255,255,0.03);
      border-bottom-color: #3b82f6;
      color: #fff;
    }

    /* Main Layout */
    .main-container {
      display: flex;
      height: calc(100vh - 160px);
    }

    @media (max-width: 1024px) {
      .main-container { flex-direction: column; height: auto; }
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: rgba(0,0,0,0.3);
      border-right: 1px solid rgba(255,255,255,0.06);
      padding: 20px;
      overflow-y: auto;
      flex-shrink: 0;
    }

    @media (max-width: 1024px) {
      .sidebar { 
        width: 100%; 
        border-right: none;
        border-bottom: 1px solid rgba(255,255,255,0.06);
        max-height: 200px;
      }
    }

    .sidebar-title {
      font-size: 10px;
      font-weight: 600;
      color: #525252;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-bottom: 14px;
    }

    .section-list { display: flex; flex-direction: column; gap: 4px; }

    @media (max-width: 1024px) {
      .section-list { flex-direction: row; flex-wrap: wrap; gap: 8px; }
    }

    .section-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      padding: 12px 14px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 8px;
      color: #888;
      font-size: 13px;
      cursor: pointer;
      text-align: left;
      font-family: inherit;
      transition: all 0.15s;
    }

    @media (max-width: 1024px) {
      .section-btn { width: auto; flex: 1; min-width: 140px; }
    }

    .section-btn:hover { background: rgba(255,255,255,0.03); }

    .section-btn.active {
      background: rgba(59,130,246,0.12);
      border-color: rgba(59,130,246,0.3);
      color: #93c5fd;
    }

    .section-num {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(255,255,255,0.05);
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 600;
      flex-shrink: 0;
    }

    .section-num.complete {
      background: rgba(34,197,94,0.2);
      border-color: #22c55e;
      color: #22c55e;
    }

    .section-num.active {
      background: rgba(59,130,246,0.2);
      border-color: #3b82f6;
      color: #60a5fa;
    }

    /* Quick Insert */
    .quick-insert {
      margin-top: 24px;
      padding: 16px;
      background: rgba(255,255,255,0.02);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    @media (max-width: 1024px) {
      .quick-insert { display: none; }
    }

    .quick-btn {
      display: block;
      width: 100%;
      padding: 8px 12px;
      margin-bottom: 6px;
      background: transparent;
      border: 1px dashed rgba(255,255,255,0.12);
      border-radius: 6px;
      color: #777;
      font-size: 11px;
      cursor: pointer;
      text-align: left;
      font-family: inherit;
      transition: all 0.15s;
    }

    .quick-btn:hover {
      border-color: rgba(59,130,246,0.4);
      color: #60a5fa;
      background: rgba(59,130,246,0.05);
    }

    /* Progress */
    .progress-box {
      margin-top: 20px;
      padding: 16px;
      background: rgba(255,255,255,0.02);
      border-radius: 10px;
    }

    @media (max-width: 1024px) {
      .progress-box { display: none; }
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 11px;
    }

    .progress-bar {
      height: 6px;
      background: rgba(255,255,255,0.08);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      border-radius: 3px;
      transition: width 0.4s ease;
    }

    /* Editor Container */
    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .editor-header {
      padding: 24px 32px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    @media (max-width: 768px) {
      .editor-header { padding: 20px 16px 16px; }
    }

    .editor-header h2 {
      font-size: 22px;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }

    .editor-header p {
      font-size: 13px;
      color: #666;
      line-height: 1.6;
      max-width: 700px;
    }

    .editor-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      gap: 6px;
      padding: 12px 32px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.2);
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .toolbar { padding: 10px 16px; }
    }

    .toolbar-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: #888;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      font-family: inherit;
      transition: all 0.15s;
    }

    .toolbar-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }

    .toolbar-divider {
      width: 1px;
      background: rgba(255,255,255,0.1);
      margin: 0 8px;
    }

    /* Content Area */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 24px 32px;
    }

    @media (max-width: 768px) {
      .content-area { padding: 16px; }
    }

    /* Company Card */
    .company-card {
      background: linear-gradient(135deg, rgba(59,130,246,0.08), rgba(139,92,246,0.05));
      border: 1px solid rgba(59,130,246,0.2);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .company-card h4 {
      color: #60a5fa;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 14px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .company-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
    }

    .info-item { font-size: 12px; }
    .info-label { color: #666; margin-bottom: 3px; }
    .info-value { color: #fff; font-weight: 500; }

    /* Editor Box */
    .editor-box {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      min-height: 450px;
    }

    .editor-content {
      padding: 24px;
      font-size: 14px;
      line-height: 1.9;
      color: #ccc;
      white-space: pre-wrap;
      outline: none;
      min-height: 400px;
    }

    .editor-content:focus {
      background: rgba(255,255,255,0.01);
    }

    .editor-content strong { color: #60a5fa; }

    /* Features Table */
    .features-table {
      margin-top: 28px;
      padding: 20px;
      background: rgba(59,130,246,0.05);
      border: 1px solid rgba(59,130,246,0.2);
      border-radius: 12px;
      overflow-x: auto;
    }

    .features-table h4 {
      color: #60a5fa;
      font-size: 14px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .features-table table {
      width: 100%;
      border-collapse: collapse;
      min-width: 550px;
    }

    .features-table th {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid rgba(59,130,246,0.25);
      color: #60a5fa;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .features-table td {
      padding: 12px;
      font-size: 13px;
      color: #ccc;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .features-table td:last-child { color: #888; font-style: italic; }

    /* AI Panel */
    .ai-panel {
      width: 340px;
      background: rgba(0,0,0,0.4);
      border-left: 1px solid rgba(255,255,255,0.06);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    @media (max-width: 1024px) {
      .ai-panel {
        width: 100%;
        border-left: none;
        border-top: 1px solid rgba(255,255,255,0.06);
        max-height: 400px;
      }
    }

    .ai-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 18px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .ai-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .ai-title { font-size: 14px; font-weight: 600; }
    .ai-subtitle { font-size: 11px; color: #666; }

    .ai-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* Analysis Box */
    .analysis-box {
      padding: 18px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .analysis-stats {
      display: flex;
      gap: 16px;
      text-align: center;
    }

    .stat { flex: 1; }

    .stat-value {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-value.green { color: #4ade80; }
    .stat-value.yellow { color: #fbbf24; }
    .stat-value.red { color: #f87171; }
    .stat-value.blue { color: #60a5fa; }

    .stat-label { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 0.05em; }

    /* Suggestions */
    .suggestion {
      padding: 16px;
      background: rgba(234,179,8,0.08);
      border-left: 3px solid #eab308;
      border-radius: 0 10px 10px 0;
      margin-bottom: 12px;
    }

    .suggestion p {
      font-size: 13px;
      color: #ddd;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .suggestion-actions { display: flex; gap: 8px; }

    .suggestion-btn {
      background: rgba(234,179,8,0.2);
      border: none;
      color: #fbbf24;
      padding: 6px 14px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 11px;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.15s;
    }

    .suggestion-btn:hover { background: rgba(234,179,8,0.3); }
    .suggestion-btn.dismiss { background: transparent; color: #666; }
    .suggestion-btn.dismiss:hover { color: #999; }

    /* Missing Box */
    .missing-box {
      margin-top: 20px;
      padding: 18px;
      background: rgba(239,68,68,0.08);
      border-radius: 12px;
      border: 1px solid rgba(239,68,68,0.2);
    }

    .missing-title {
      font-size: 12px;
      font-weight: 600;
      color: #f87171;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .missing-list {
      margin: 0;
      padding: 0 0 0 18px;
      font-size: 12px;
      color: #ccc;
      line-height: 1.9;
    }

    /* AI Input */
    .ai-input-container {
      padding: 16px 20px;
      border-top: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.2);
    }

    .ai-input-box {
      display: flex;
      gap: 10px;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .ai-input {
      flex: 1;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 13px;
      outline: none;
      font-family: inherit;
    }

    .ai-input::placeholder { color: #555; }

    .ai-send-btn {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      border: none;
      color: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.15s;
    }

    .ai-send-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(139,92,246,0.4); }

    /* Compliance Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-overlay.show { display: flex; }

    .modal {
      background: linear-gradient(180deg, #0f0f15 0%, #0a0a0f 100%);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      width: 100%;
      max-width: 900px;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 80px rgba(0,0,0,0.6);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .modal-header h3 {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-close {
      background: rgba(255,255,255,0.1);
      border: none;
      color: #888;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.15s;
    }

    .modal-close:hover { background: rgba(255,255,255,0.15); color: #fff; }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-body > p {
      font-size: 13px;
      color: #888;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .compliance-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
    }

    .compliance-table th {
      padding: 14px;
      text-align: left;
      border-bottom: 1px solid #333;
      color: #888;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .compliance-table td {
      padding: 14px;
      font-size: 13px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .compliance-table .req-id { color: #60a5fa; font-weight: 600; }

    .compliance-table input {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      padding: 8px 12px;
      color: #fff;
      font-size: 12px;
      width: 100%;
      font-family: inherit;
      transition: all 0.15s;
    }

    .compliance-table input:focus {
      border-color: rgba(59,130,246,0.5);
      outline: none;
    }

    .status-dot {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(255,255,255,0.08);
      border: 1px solid #444;
      margin: 0 auto;
      cursor: pointer;
      transition: all 0.15s;
    }

    .status-dot:hover { border-color: #22c55e; }

    .status-dot.complete {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header { padding: 12px 16px; }
      .header-title h1 { font-size: 14px; }
      .opportunity-bar { padding: 12px 16px; }
      .opp-meta { display: none; }
      .volume-tab { padding: 12px 16px; font-size: 12px; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <a href="/" class="back-btn" onclick="localStorage.removeItem('currentOpportunity')">‚Üê Dashboard</a>
      <div class="header-title">
        <h1>
          Proposal Editor
          <span class="badge pro">PRO</span>
        </h1>
        <p>Federal proposal workspace with AI assistance</p>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn" onclick="toggleModal()">üìã Compliance Matrix</button>
      <button class="btn" onclick="saveDraft()">üíæ Save Draft</button>
      <button class="btn" onclick="exportWord()" style="background: rgba(59,130,246,0.2); border-color: rgba(59,130,246,0.4); color: #60a5fa;">üìÑ Export Word</button>
      <button class="btn btn-primary" onclick="exportPDF()">üì§ Export PDF</button>
    </div>
  </header>

  <!-- Opportunity Selector -->
  <div class="opportunity-bar">
    <label>Opportunity:</label>
    <select class="opportunity-select" id="opportunitySelect" onchange="loadOpportunity()">
      <option value="">-- Select an opportunity --</option>
      <option value="opp1" selected>SPE4A1-25-R-0087 - Industrial Automation Integration Services</option>
      <option value="opp2">W912DY-25-R-0034 - Robotic Material Handling System</option>
      <option value="opp3">N00024-25-R-4421 - AI Vision Quality Control</option>
    </select>
    <div class="opp-meta">
      <span>Agency: <strong>DLA Aviation</strong></span>
      <span>Value: <strong>$2.4M</strong></span>
      <span>Due: <strong>Jan 15, 2025</strong></span>
    </div>
  </div>

  <!-- Volume Tabs -->
  <div class="volume-tabs">
    <button class="volume-tab active" onclick="switchVolume('I', this)">Volume I: Business/Admin</button>
    <button class="volume-tab" onclick="switchVolume('II', this)">Volume II: Technical</button>
    <button class="volume-tab" onclick="switchVolume('III', this)">Volume III: Cost/Price</button>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    
    <!-- Sidebar -->
    <nav class="sidebar">
      <p class="sidebar-title">Sections</p>
      <div class="section-list" id="sectionList"></div>

      <div class="quick-insert">
        <p class="sidebar-title">Quick Insert</p>
        <button class="quick-btn" onclick="insertText('CAGE Code: 86VF7')">+ CAGE: 86VF7</button>
        <button class="quick-btn" onclick="insertText('UEI: GJ1DPYQ3X8K5')">+ UEI: GJ1DPYQ3X8K5</button>
        <button class="quick-btn" onclick="insertText('NAICS: 333249, 333922, 541330, 541512, 541715, 238210')">+ NAICS Codes</button>
        <button class="quick-btn" onclick="insertCompanyOverview()">+ Company Overview</button>
        <button class="quick-btn" onclick="insertCapabilities()">+ Core Capabilities</button>
      </div>

      <div class="progress-box">
        <div class="progress-header">
          <span style="color:#666">Proposal Progress</span>
          <span id="progressPercent" style="color:#22c55e">18%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 18%"></div>
        </div>
      </div>
    </nav>

    <!-- Editor -->
    <div class="editor-container">
      <div class="editor-header">
        <h2 id="sectionTitle">Executive Summary</h2>
        <p id="sectionGuidance">The Executive Summary should capture the evaluator's attention and summarize your key discriminators. Keep it to 1-2 pages.</p>
        <div class="editor-actions">
          <button class="btn btn-ai" onclick="generateWithAI()">‚ú® AI Generate Section</button>
          <button class="btn" onclick="loadTemplate()">üìÑ Load Template</button>
          <button class="btn" onclick="checkCompliance()">‚úì Check Compliance</button>
        </div>
      </div>

      <div class="toolbar">
        <button class="toolbar-btn" onclick="formatText('h1')">H1</button>
        <button class="toolbar-btn" onclick="formatText('h2')">H2</button>
        <button class="toolbar-btn" onclick="formatText('bold')">B</button>
        <button class="toolbar-btn" onclick="formatText('italic')">I</button>
        <span class="toolbar-divider"></span>
        <button class="toolbar-btn" onclick="formatText('ul')">‚Ä¢ List</button>
        <button class="toolbar-btn" onclick="formatText('ol')">1. Numbered</button>
        <button class="toolbar-btn" onclick="insertTable()">üìä Table</button>
      </div>

      <div class="content-area">
        <div class="company-card">
          <h4>Singh Automation LLC</h4>
          <div class="company-info">
            <div class="info-item">
              <div class="info-label">CAGE Code</div>
              <div class="info-value">86VF7</div>
            </div>
            <div class="info-item">
              <div class="info-label">UEI</div>
              <div class="info-value">GJ1DPYQ3X8K5</div>
            </div>
            <div class="info-item">
              <div class="info-label">HQ Location</div>
              <div class="info-value">Kalamazoo, MI</div>
            </div>
            <div class="info-item">
              <div class="info-label">Sales Office</div>
              <div class="info-value">Irvine, CA</div>
            </div>
          </div>
        </div>

        <div class="editor-box">
          <div class="editor-content" contenteditable="true" id="editorContent"><strong>Singh Automation LLC</strong> proposes to provide industrial automation integration services to DLA Aviation in response to Solicitation SPE4A1-25-R-0087.

<strong>Understanding of Requirements</strong>
DLA Aviation requires a qualified contractor to deliver comprehensive industrial automation solutions supporting depot-level maintenance operations. Singh Automation understands the critical nature of these requirements and the need for minimal disruption to ongoing operations.

<strong>Our Solution</strong>
As an authorized FANUC and Universal Robots integrator, Singh Automation delivers turnkey automation solutions meeting stringent defense requirements. Our approach combines proven robotics integration, AI vision systems, and PLC/SCADA controls to maximize operational efficiency.

<strong>Key Discriminators</strong>
‚Ä¢ Authorized FANUC & Universal Robots Integrator ‚Äì Direct OEM support, certified technicians, full warranty coverage
‚Ä¢ 23+ Years Technical Excellence ‚Äì Proven track record delivering complex integration projects on time and within budget
‚Ä¢ Dual-Location Presence ‚Äì HQ in Kalamazoo, MI and Sales in Irvine, CA for nationwide coverage and rapid response
‚Ä¢ Small Business Advantage ‚Äì Agile decision-making, competitive pricing, dedicated project focus

<strong>Relevant Experience</strong>
[Reference 3-5 similar contracts with government agencies]

<strong>Team Qualifications</strong>
[Overview of key personnel: Program Manager, Technical Lead, QA Manager]</div>
        </div>

        <div class="features-table" id="featuresTable">
          <h4>üìä Features / Benefits / Proof Points</h4>
          <table>
            <thead>
              <tr>
                <th>Feature</th>
                <th>Benefit to Government</th>
                <th>Proof Point</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Authorized FANUC Integrator</td>
                <td>Direct OEM support, certified technicians, warranty coverage</td>
                <td>15+ FANUC installations since 2019</td>
              </tr>
              <tr>
                <td>AI Vision Systems</td>
                <td>Improved quality control, reduced inspection time by 60%</td>
                <td>Deployed at 3 manufacturing facilities</td>
              </tr>
              <tr>
                <td>PLC/SCADA Controls</td>
                <td>Industry-standard, reliable, maintainable systems</td>
                <td>Allen-Bradley & Siemens certified team</td>
              </tr>
              <tr>
                <td>Small Business (CAGE: 86VF7)</td>
                <td>Supports agency small business goals, competitive rates</td>
                <td>Registered in SAM.gov, verified credentials</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- AI Panel -->
    <aside class="ai-panel">
      <div class="ai-header">
        <div class="ai-icon">‚ú®</div>
        <div>
          <div class="ai-title">AI Proposal Assistant</div>
          <div class="ai-subtitle">Trained on winning federal proposals</div>
        </div>
      </div>

      <div class="ai-content">
        <div class="analysis-box">
          <p class="sidebar-title">Section Analysis</p>
          <div class="analysis-stats">
            <div class="stat">
              <div class="stat-value green" id="winScore">74</div>
              <div class="stat-label">Win Score</div>
            </div>
            <div class="stat">
              <div class="stat-value yellow" id="issueCount">2</div>
              <div class="stat-label">Issues</div>
            </div>
            <div class="stat">
              <div class="stat-value blue" id="tipCount">4</div>
              <div class="stat-label">Tips</div>
            </div>
          </div>
        </div>

        <p class="sidebar-title">Suggestions</p>

        <div class="suggestion">
          <p>Add specific contract values from past performance to strengthen credibility with evaluators.</p>
          <div class="suggestion-actions">
            <button class="suggestion-btn" onclick="applySuggestion(1)">Apply</button>
            <button class="suggestion-btn dismiss">Dismiss</button>
          </div>
        </div>

        <div class="suggestion">
          <p>Include key personnel names and their relevant certifications (PMP, FANUC certified, etc.)</p>
          <div class="suggestion-actions">
            <button class="suggestion-btn" onclick="applySuggestion(2)">Apply</button>
            <button class="suggestion-btn dismiss">Dismiss</button>
          </div>
        </div>

        <div class="missing-box">
          <div class="missing-title">‚ö†Ô∏è Missing Elements</div>
          <ul class="missing-list">
            <li>Past performance contract references</li>
            <li>Key personnel names and resumes</li>
          </ul>
        </div>
      </div>

      <div class="ai-input-container">
        <div class="ai-input-box">
          <input type="text" class="ai-input" id="aiInput" placeholder="Ask AI for help with this section...">
          <button class="ai-send-btn" onclick="sendAIMessage()">Send</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Compliance Matrix Modal -->
  <div class="modal-overlay" id="complianceModal">
    <div class="modal">
      <div class="modal-header">
        <h3>üìã Compliance Matrix</h3>
        <button class="modal-close" onclick="toggleModal()">√ó</button>
      </div>
      <div class="modal-body">
        <p>Track each RFP requirement (Section L) against evaluation criteria (Section M) and map to your proposal response.</p>
        <div style="overflow-x: auto;">
          <table class="compliance-table">
            <thead>
              <tr>
                <th>Req ID</th>
                <th>Requirement (Section L)</th>
                <th>Eval Criteria (M)</th>
                <th>Proposal Reference</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="complianceBody">
              <tr>
                <td class="req-id">L.1</td>
                <td style="color:#ccc">Provide detailed technical approach addressing each SOW task</td>
                <td style="color:#888">M.1 - Technical</td>
                <td><input type="text" placeholder="Vol II, Sec 2.0, pg 4"></td>
                <td><div class="status-dot" onclick="toggleStatus(this)"></div></td>
              </tr>
              <tr>
                <td class="req-id">L.2</td>
                <td style="color:#ccc">Include organizational chart with key personnel</td>
                <td style="color:#888">M.2 - Management</td>
                <td><input type="text" placeholder="Vol II, Sec 3.1, pg 8"></td>
                <td><div class="status-dot" onclick="toggleStatus(this)"></div></td>
              </tr>
              <tr>
                <td class="req-id">L.3</td>
                <td style="color:#ccc">List key personnel with qualifications and resumes</td>
                <td style="color:#888">M.3 - Personnel</td>
                <td><input type="text" placeholder="Vol II, Sec 4.0, pg 12"></td>
                <td><div class="status-dot" onclick="toggleStatus(this)"></div></td>
              </tr>
              <tr>
                <td class="req-id">L.4</td>
                <td style="color:#ccc">Provide minimum 3 past performance references</td>
                <td style="color:#888">M.4 - Past Perf</td>
                <td><input type="text" placeholder="Vol II, Sec 5.0, pg 18"></td>
                <td><div class="status-dot" onclick="toggleStatus(this)"></div></td>
              </tr>
              <tr>
                <td class="req-id">L.5</td>
                <td style="color:#ccc">Detail quality control and assurance procedures</td>
                <td style="color:#888">M.5 - Quality</td>
                <td><input type="text" placeholder="Vol II, Sec 6.0, pg 22"></td>
                <td><div class="status-dot" onclick="toggleStatus(this)"></div></td>
              </tr>
              <tr>
                <td class="req-id">L.6</td>
                <td style="color:#ccc">Provide risk identification and mitigation plan</td>
                <td style="color:#888">M.6 - Risk</td>
                <td><input type="text" placeholder="Vol II, Sec 7.0, pg 25"></td>
                <td><div class="status-dot" onclick="toggleStatus(this)"></div></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Data
    const volumes = {
      'I': {
        name: 'Business/Admin',
        sections: [
          { id: 'cover', label: 'Cover Letter & SF-33', status: 'complete' },
          { id: 'reps', label: 'Reps & Certifications', status: 'complete' },
          { id: 'cage', label: 'CAGE / UEI / NAICS', status: 'complete' },
          { id: 'subcon', label: 'Subcontracting Plan', status: 'pending' }
        ]
      },
      'II': {
        name: 'Technical',
        sections: [
          { id: 'executive', label: 'Executive Summary', status: 'active' },
          { id: 'technical', label: 'Technical Approach', status: 'pending' },
          { id: 'management', label: 'Management Plan', status: 'pending' },
          { id: 'personnel', label: 'Key Personnel', status: 'pending' },
          { id: 'past', label: 'Past Performance', status: 'pending' },
          { id: 'quality', label: 'Quality Assurance', status: 'pending' },
          { id: 'risk', label: 'Risk Mitigation', status: 'pending' }
        ]
      },
      'III': {
        name: 'Cost/Price',
        sections: [
          { id: 'pricing', label: 'Pricing Matrix', status: 'pending' },
          { id: 'labor', label: 'Labor Categories & Rates', status: 'pending' },
          { id: 'odc', label: 'ODCs & Materials', status: 'pending' }
        ]
      }
    };

    const sectionContent = {
      executive: { title: 'Executive Summary', guidance: 'The Executive Summary should capture the evaluator\'s attention and summarize your key discriminators. Keep it to 1-2 pages.' },
      technical: { title: 'Technical Approach', guidance: 'Address each SOW/PWS requirement. Show HOW you will accomplish each task, not just WHAT you will do. Use Features/Benefits tables.' },
      management: { title: 'Management Plan', guidance: 'Describe organizational structure, communication plan, and contract management approach. Include org chart.' },
      personnel: { title: 'Key Personnel', guidance: 'Identify personnel critical to success. Include qualifications, certifications, and attach resumes.' },
      past: { title: 'Past Performance', guidance: 'Provide 3-5 relevant contract references. Emphasize SIMILAR work in scope, size, and complexity.' },
      quality: { title: 'Quality Assurance', guidance: 'Describe QA/QC processes, metrics, inspection points, and corrective action procedures.' },
      risk: { title: 'Risk Mitigation', guidance: 'Identify potential risks, assess likelihood/impact, and describe mitigation strategies.' },
      cover: { title: 'Cover Letter & SF-33', guidance: 'The cover letter introduces your proposal. SF-33 should be the first page of Volume I.' },
      reps: { title: 'Representations & Certifications', guidance: 'Complete all required reps and certs per solicitation instructions.' },
      cage: { title: 'CAGE / UEI / NAICS', guidance: 'List your CAGE code (86VF7), UEI (GJ1DPYQ3X8K5), and applicable NAICS codes.' },
      subcon: { title: 'Subcontracting Plan', guidance: 'If required, detail small business subcontracting goals and approach.' },
      pricing: { title: 'Pricing Matrix', guidance: 'Provide pricing in the format specified in RFP Section L.' },
      labor: { title: 'Labor Categories & Rates', guidance: 'Define each labor category with qualifications and proposed rates.' },
      odc: { title: 'ODCs & Materials', guidance: 'List other direct costs and materials with pricing basis.' }
    };

    let currentVolume = 'II';
    let currentSection = 'executive';

    function renderSections() {
      const list = document.getElementById('sectionList');
      list.innerHTML = '';
      volumes[currentVolume].sections.forEach((section, idx) => {
        const btn = document.createElement('button');
        btn.className = 'section-btn' + (section.id === currentSection ? ' active' : '');
        const numClass = section.status === 'complete' ? 'complete' : (section.id === currentSection ? 'active' : '');
        btn.innerHTML = `<span class="section-num ${numClass}">${section.status === 'complete' ? '‚úì' : idx + 1}</span>${section.label}`;
        btn.onclick = () => switchSection(section.id);
        list.appendChild(btn);
      });
    }

    function switchVolume(vol, btn) {
      currentVolume = vol;
      currentSection = volumes[vol].sections[0].id;
      document.querySelectorAll('.volume-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      renderSections();
      updateEditor();
    }

    function switchSection(sectionId) {
      currentSection = sectionId;
      renderSections();
      updateEditor();
    }

    function updateEditor() {
      const content = sectionContent[currentSection] || { title: 'Section', guidance: '' };
      document.getElementById('sectionTitle').textContent = content.title;
      document.getElementById('sectionGuidance').textContent = content.guidance;
      document.getElementById('featuresTable').style.display = 
        (currentSection === 'executive' || currentSection === 'technical') ? 'block' : 'none';
    }

    function toggleModal() {
      document.getElementById('complianceModal').classList.toggle('show');
    }

    function toggleStatus(dot) {
      dot.classList.toggle('complete');
    }

    function insertText(text) {
      const editor = document.getElementById('editorContent');
      editor.focus();
      document.execCommand('insertText', false, '\n' + text + '\n');
    }

    function insertCompanyOverview() {
      const text = `\nSingh Automation LLC is an authorized FANUC and Universal Robots integrator headquartered in Kalamazoo, MI with sales operations in Irvine, CA.

CAGE Code: 86VF7
UEI: GJ1DPYQ3X8K5
Business Size: Small Business

NAICS Codes:
‚Ä¢ 333249 - Other Industrial Machinery Manufacturing
‚Ä¢ 333922 - Conveyor and Conveying Equipment Manufacturing  
‚Ä¢ 541330 - Engineering Services
‚Ä¢ 541512 - Computer Systems Design Services
‚Ä¢ 541715 - R&D in Physical, Engineering, and Life Sciences
‚Ä¢ 238210 - Electrical Contractors\n`;
      insertText(text);
    }

    function insertCapabilities() {
      const text = `\nCore Capabilities:
‚Ä¢ Robotics Integration (FANUC, Universal Robots, ABB)
‚Ä¢ AI Vision Systems & Machine Learning
‚Ä¢ PLC/SCADA Controls (Allen-Bradley, Siemens)
‚Ä¢ Conveyor Systems & Material Handling
‚Ä¢ HPC Infrastructure & Data Center Equipment
‚Ä¢ System Integration & Custom Automation Solutions\n`;
      insertText(text);
    }

    function formatText(type) {
      // Simplified formatting
      const editor = document.getElementById('editorContent');
      editor.focus();
      if (type === 'bold') document.execCommand('bold');
      if (type === 'italic') document.execCommand('italic');
    }

    async function generateWithAI() {
      const section = currentSection;
      const storedOpp = localStorage.getItem('currentOpportunity');
      
      if (!storedOpp) {
        alert('Please select an opportunity first');
        return;
      }
      
      const opportunity = JSON.parse(storedOpp);
      const btn = document.querySelector('.btn-ai');
      const originalText = btn.innerHTML;
      
      // Show loading state
      btn.innerHTML = '‚è≥ Generating...';
      btn.disabled = true;
      
      try {
        const response = await fetch('/api/generate-section', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            section: section,
            opportunity: opportunity,
            companyInfo: {
              name: 'Singh Automation LLC',
              cage: '86VF7',
              uei: 'GJ1DPYQ3X8K5',
              hq: 'Kalamazoo, MI',
              sales: 'Irvine, CA',
              capabilities: [
                'FANUC & Universal Robots Integration',
                'AI Vision Systems & Machine Learning',
                'PLC/SCADA Controls (Allen-Bradley, Siemens)',
                'Conveyor Systems & Material Handling',
                'HPC Infrastructure & Data Center Equipment'
              ],
              certs: ['FANUC ASI', 'UR CSP', 'MBE', 'WBENC']
            }
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success && data.content) {
          // Format the content with proper HTML
          const formattedContent = formatAIContent(data.content);
          document.getElementById('editorContent').innerHTML = formattedContent;
          
          // Update progress
          updateProgress();
          
          // Show success
          btn.innerHTML = '‚úÖ Generated!';
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
          }, 2000);
        } else {
          throw new Error(data.error || 'Generation failed');
        }
        
      } catch (error) {
        console.error('AI Generation error:', error);
        alert('AI Generation failed: ' + error.message + '\n\nMake sure the backend is running with ANTHROPIC_API_KEY configured.');
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }
    
    function formatAIContent(text) {
      // Convert markdown-style formatting to HTML
      let html = text
        // Headers
        .replace(/^### (.*$)/gm, '<strong style="color:#60a5fa;font-size:14px;">$1</strong>')
        .replace(/^## (.*$)/gm, '<strong style="color:#60a5fa;font-size:16px;">$1</strong>')
        .replace(/^# (.*$)/gm, '<strong style="color:#60a5fa;font-size:18px;">$1</strong>')
        // Bold
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        // Bullets
        .replace(/^- (.*$)/gm, '‚Ä¢ $1')
        .replace(/^\* (.*$)/gm, '‚Ä¢ $1')
        // Numbered lists
        .replace(/^\d+\. (.*$)/gm, '$&')
        // Line breaks
        .replace(/\n\n/g, '\n\n')
        .replace(/\n/g, '\n');
      
      return html;
    }
    
    function updateProgress() {
      // Simple progress tracking based on content length
      const editor = document.getElementById('editorContent');
      const content = editor.innerText || '';
      const wordCount = content.split(/\s+/).filter(w => w.length > 0).length;
      
      // Estimate progress based on word count (target ~500 words per section)
      const sectionProgress = Math.min(100, Math.round((wordCount / 500) * 100));
      
      // Update UI
      document.getElementById('progressPercent').textContent = sectionProgress + '%';
      document.getElementById('progressFill').style.width = sectionProgress + '%';
      
      // Update section status
      if (wordCount > 100) {
        const currentBtn = document.querySelector('.section-btn.active .section-num');
        if (currentBtn) {
          currentBtn.classList.add('complete');
          currentBtn.textContent = '‚úì';
        }
      }
    }

    function loadTemplate() {
      const templates = {
        executive: `<strong>EXECUTIVE SUMMARY</strong>

<strong>Singh Automation LLC</strong> is pleased to submit this proposal in response to [Solicitation Number].

<strong>1.0 Understanding of Requirements</strong>
[Demonstrate clear understanding of what the government needs]

<strong>2.0 Our Solution</strong>
[Brief overview of your technical approach]

<strong>3.0 Key Discriminators</strong>
‚Ä¢ [Discriminator 1 - What makes you unique]
‚Ä¢ [Discriminator 2 - Specific capability]
‚Ä¢ [Discriminator 3 - Past performance highlight]
‚Ä¢ [Discriminator 4 - Value proposition]

<strong>4.0 Relevant Experience</strong>
[Summary of most relevant past performance]

<strong>5.0 Conclusion</strong>
Singh Automation is confident in our ability to deliver exceptional results. We look forward to the opportunity to serve [Agency].`,

        technical: `<strong>TECHNICAL APPROACH</strong>

<strong>1.0 Technical Understanding</strong>
[Demonstrate understanding of the technical requirements]

<strong>2.0 Proposed Solution</strong>

<strong>2.1 Phase 1: Planning & Design</strong>
‚Ä¢ Task 1.1: Requirements Analysis
‚Ä¢ Task 1.2: System Design
‚Ä¢ Task 1.3: Design Review

<strong>2.2 Phase 2: Implementation</strong>
‚Ä¢ Task 2.1: [Implementation Task]
‚Ä¢ Task 2.2: [Implementation Task]
‚Ä¢ Task 2.3: Integration & Testing

<strong>2.3 Phase 3: Deployment & Support</strong>
‚Ä¢ Task 3.1: System Deployment
‚Ä¢ Task 3.2: Training
‚Ä¢ Task 3.3: Documentation

<strong>3.0 Tools & Technologies</strong>
‚Ä¢ [Technology 1]
‚Ä¢ [Technology 2]
‚Ä¢ [Technology 3]

<strong>4.0 Quality Assurance</strong>
[How you will ensure quality deliverables]

<strong>5.0 Innovation & Value-Adds</strong>
[What extra value you bring beyond requirements]`,

        management: `<strong>MANAGEMENT PLAN</strong>

<strong>1.0 Program Management Approach</strong>
[Overview of management philosophy]

<strong>2.0 Organizational Structure</strong>
[Description of org chart - Program Manager > Technical Lead > Team]

<strong>3.0 Key Personnel</strong>
‚Ä¢ Program Manager: [Name/TBD]
‚Ä¢ Technical Lead: [Name/TBD]
‚Ä¢ QA Manager: [Name/TBD]

<strong>4.0 Communication Plan</strong>
‚Ä¢ Weekly Status Meetings
‚Ä¢ Monthly Progress Reports
‚Ä¢ Quarterly Reviews
‚Ä¢ Issue Escalation Procedures

<strong>5.0 Schedule Management</strong>
[How you will manage schedule and milestones]

<strong>6.0 Risk Management</strong>
[Overview of risk identification and mitigation approach]`,

        personnel: `<strong>KEY PERSONNEL</strong>

<strong>1.0 Program Manager</strong>
Name: [TBD]
Role: Overall contract responsibility
Qualifications:
‚Ä¢ PMP Certification
‚Ä¢ 10+ years program management
‚Ä¢ Federal contracting experience
‚Ä¢ [Security clearance if required]

<strong>2.0 Technical Lead</strong>
Name: [TBD]
Role: Technical solution delivery
Qualifications:
‚Ä¢ [Relevant degree]
‚Ä¢ [Technical certifications]
‚Ä¢ 8+ years technical experience
‚Ä¢ [Specific technology expertise]

<strong>3.0 Quality Assurance Manager</strong>
Name: [TBD]
Role: Quality control and compliance
Qualifications:
‚Ä¢ ISO 9001 Lead Auditor
‚Ä¢ 5+ years QA experience
‚Ä¢ [Industry-specific certifications]`,

        past: `<strong>PAST PERFORMANCE</strong>

<strong>Contract 1: [Contract Name]</strong>
‚Ä¢ Contract Number: [Number]
‚Ä¢ Agency: [Customer Agency]
‚Ä¢ POC: [Name, Phone, Email]
‚Ä¢ Value: $[Amount]
‚Ä¢ Period: [Start] - [End]
‚Ä¢ Scope: [Brief description of work performed]
‚Ä¢ Relevance: [How this relates to current opportunity]
‚Ä¢ Key Achievements:
  - [Achievement with metrics]
  - [Achievement with metrics]

<strong>Contract 2: [Contract Name]</strong>
[Same format as above]

<strong>Contract 3: [Contract Name]</strong>
[Same format as above]`,

        quality: `<strong>QUALITY ASSURANCE PLAN</strong>

<strong>1.0 Quality Management System</strong>
[Overview of QMS approach]

<strong>2.0 Quality Control Procedures</strong>
‚Ä¢ Inspection Points
‚Ä¢ Testing Protocols
‚Ä¢ Acceptance Criteria

<strong>3.0 Documentation</strong>
‚Ä¢ Quality Records
‚Ä¢ Audit Trails
‚Ä¢ Corrective Action Reports

<strong>4.0 Certifications & Standards</strong>
‚Ä¢ [ISO 9001 / AS9100 / etc.]
‚Ä¢ [Industry-specific standards]

<strong>5.0 Continuous Improvement</strong>
[How you drive ongoing quality improvement]`,

        risk: `<strong>RISK MITIGATION PLAN</strong>

<strong>1.0 Risk Management Approach</strong>
[Overview of risk identification and management methodology]

<strong>2.0 Risk Assessment Matrix</strong>
Likelihood: Low (1) | Medium (2) | High (3)
Impact: Low (1) | Medium (2) | High (3)
Risk Score = Likelihood √ó Impact

<strong>3.0 Identified Risks</strong>

<strong>Risk 1: [Risk Name]</strong>
‚Ä¢ Description: [What could go wrong]
‚Ä¢ Likelihood: [L/M/H]
‚Ä¢ Impact: [L/M/H]
‚Ä¢ Mitigation: [How you will prevent it]
‚Ä¢ Contingency: [What you will do if it occurs]

<strong>Risk 2: [Risk Name]</strong>
[Same format]

<strong>Risk 3: [Risk Name]</strong>
[Same format]

<strong>4.0 Risk Monitoring</strong>
[How risks will be tracked and reported]`
      };
      
      const template = templates[currentSection];
      if (template) {
        document.getElementById('editorContent').innerHTML = template;
        updateProgress();
      }
    }

    function checkCompliance() {
      toggleModal();
    }

    function applySuggestion(num) {
      if (num === 1) {
        insertText('\nPast Contract Values: Successfully delivered $1.2M robotics integration for [Agency], $850K conveyor system for [Client].\n');
      } else if (num === 2) {
        insertText('\nKey Personnel:\n‚Ä¢ Program Manager: [Name], PMP Certified, 15 years federal contracting\n‚Ä¢ Technical Lead: [Name], FANUC Certified, 10 years automation\n‚Ä¢ QA Manager: [Name], ISO 9001 Lead Auditor\n');
      }
    }

    function sendAIMessage() {
      const input = document.getElementById('aiInput');
      if (input.value.trim()) {
        alert('AI Response coming soon! You asked: ' + input.value);
        input.value = '';
      }
    }

    function loadOpportunity() {
      const select = document.getElementById('opportunitySelect');
      const oppId = select.value;
      
      // Try to get from localStorage
      const stored = localStorage.getItem('currentOpportunity');
      if (stored) {
        const opp = JSON.parse(stored);
        populateFromOpportunity(opp);
      }
    }

    function populateFromOpportunity(opp) {
      if (!opp) return;
      
      // Update opportunity selector display
      const select = document.getElementById('opportunitySelect');
      const optionText = `${opp.noticeId || opp.id} - ${opp.title}`;
      
      // Add this opportunity to dropdown if not exists
      let found = false;
      for (let opt of select.options) {
        if (opt.value === opp.id) {
          opt.selected = true;
          found = true;
          break;
        }
      }
      if (!found) {
        const newOpt = document.createElement('option');
        newOpt.value = opp.id;
        newOpt.textContent = optionText;
        newOpt.selected = true;
        select.appendChild(newOpt);
      }
      
      // Update meta display
      const metaDiv = document.querySelector('.opp-meta');
      if (metaDiv) {
        const agency = opp.agency || opp.departmentName || 'Federal';
        const value = opp.value ? `$${(opp.value/1000000).toFixed(1)}M` : 'TBD';
        const due = opp.deadline || opp.responseDeadLine || 'See Solicitation';
        metaDiv.innerHTML = `
          <span>Agency: <strong>${agency}</strong></span>
          <span>Value: <strong>${value}</strong></span>
          <span>Due: <strong>${due}</strong></span>
        `;
      }
      
      // Pre-fill Executive Summary with opportunity details
      const editor = document.getElementById('editorContent');
      if (editor && opp.title) {
        const value = opp.value ? `$${(opp.value).toLocaleString()}` : '[TBD]';
        const agency = opp.agency || opp.departmentName || '[Agency]';
        const noticeId = opp.noticeId || opp.id || '[Solicitation #]';
        
        editor.innerHTML = `<strong>Singh Automation LLC</strong> proposes to provide ${opp.title.toLowerCase().includes('service') ? 'services' : 'industrial automation solutions'} to ${agency} in response to Solicitation ${noticeId}.

<strong>Understanding of Requirements</strong>
${opp.description || '[Review solicitation and summarize key requirements here]'}

<strong>Our Solution</strong>
As an authorized FANUC and Universal Robots integrator, Singh Automation delivers turnkey automation solutions meeting stringent ${agency.includes('Defense') || agency.includes('Army') || agency.includes('Navy') || agency.includes('Air Force') ? 'defense' : 'federal'} requirements. Our approach combines proven robotics integration, AI vision systems, and PLC/SCADA controls to maximize operational efficiency.

<strong>Key Discriminators</strong>
‚Ä¢ Authorized FANUC & Universal Robots Integrator ‚Äì Direct OEM support, certified technicians, full warranty coverage
‚Ä¢ 23+ Years Technical Excellence ‚Äì Proven track record delivering complex integration projects on time and within budget
‚Ä¢ Dual-Location Presence ‚Äì HQ in Kalamazoo, MI and Sales in Irvine, CA for nationwide coverage and rapid response
‚Ä¢ Small Business Advantage ‚Äì Agile decision-making, competitive pricing, dedicated project focus

<strong>Contract Value</strong>
Estimated value: ${value}

<strong>Relevant Experience</strong>
[Reference 3-5 similar contracts with government agencies]

<strong>Team Qualifications</strong>
[Overview of key personnel: Program Manager, Technical Lead, QA Manager]`;
      }
      
      // Update page title
      document.querySelector('.header-title p').textContent = opp.title || 'Federal proposal workspace with AI assistance';
    }

    function insertTable() {
      insertText('\n| Column 1 | Column 2 | Column 3 |\n|----------|----------|----------|\n| Data     | Data     | Data     |\n');
    }

    // Close modal on outside click
    document.getElementById('complianceModal').addEventListener('click', function(e) {
      if (e.target === this) toggleModal();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        alert('Draft saved!');
      }
    });

    // Init
    renderSections();
    
    // Load opportunity from localStorage if available
    const storedOpp = localStorage.getItem('currentOpportunity');
    if (storedOpp) {
      try {
        const opp = JSON.parse(storedOpp);
        populateFromOpportunity(opp);
        console.log('Loaded opportunity:', opp.title);
      } catch (e) {
        console.error('Failed to load opportunity:', e);
      }
    }
    
    // ========== EXPORT FUNCTIONS ==========
    
    function saveDraft() {
      const content = document.getElementById('editorContent').innerHTML;
      const oppData = localStorage.getItem('currentOpportunity');
      const opp = oppData ? JSON.parse(oppData) : { id: 'draft' };
      
      const draft = {
        id: opp.id || 'draft',
        title: opp.title || 'Untitled Proposal',
        content: content,
        section: currentSection,
        volume: currentVolume,
        savedAt: new Date().toISOString()
      };
      
      // Save to localStorage
      const drafts = JSON.parse(localStorage.getItem('proposalDrafts') || '{}');
      drafts[draft.id] = draft;
      localStorage.setItem('proposalDrafts', JSON.stringify(drafts));
      
      // Visual feedback
      const btn = document.querySelector('button[onclick="saveDraft()"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚úÖ Saved!';
      btn.style.background = 'rgba(34,197,94,0.2)';
      btn.style.borderColor = 'rgba(34,197,94,0.4)';
      btn.style.color = '#4ade80';
      
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = '';
        btn.style.borderColor = '';
        btn.style.color = '';
      }, 2000);
      
      console.log('Draft saved:', draft.id);
    }
    
    function exportWord() {
      const content = document.getElementById('editorContent').innerHTML;
      const oppData = localStorage.getItem('currentOpportunity');
      const opp = oppData ? JSON.parse(oppData) : {};
      
      const title = opp.title || 'Federal Proposal';
      const agency = opp.agency || opp.departmentName || 'Federal Agency';
      const solicitation = opp.noticeId || opp.id || '';
      
      // Create Word-compatible HTML
      const wordContent = `
<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office" 
      xmlns:w="urn:schemas-microsoft-com:office:word"
      xmlns="http://www.w3.org/TR/REC-html40">
<head>
  <meta charset="UTF-8">
  <title>${title}</title>
  <style>
    @page { 
      size: 8.5in 11in; 
      margin: 1in; 
    }
    body { 
      font-family: 'Times New Roman', Times, serif; 
      font-size: 12pt; 
      line-height: 1.5; 
      color: #000;
    }
    .header-block {
      text-align: center;
      margin-bottom: 24pt;
      border-bottom: 2pt solid #1a365d;
      padding-bottom: 12pt;
    }
    .company-name {
      font-size: 18pt;
      font-weight: bold;
      color: #1a365d;
    }
    .company-info {
      font-size: 10pt;
      color: #666;
    }
    .proposal-title {
      font-size: 16pt;
      font-weight: bold;
      margin: 18pt 0 6pt;
      color: #1a365d;
    }
    .solicitation {
      font-size: 11pt;
      color: #666;
      margin-bottom: 18pt;
    }
    h1, h2, h3 { color: #1a365d; }
    h1 { font-size: 14pt; margin: 18pt 0 12pt; border-bottom: 1pt solid #ccc; }
    h2 { font-size: 13pt; margin: 14pt 0 10pt; }
    h3 { font-size: 12pt; margin: 12pt 0 8pt; }
    p { margin: 0 0 10pt; text-align: justify; }
    ul, ol { margin: 0 0 10pt 24pt; }
    li { margin-bottom: 4pt; }
    strong { color: #1a365d; }
    .footer {
      margin-top: 24pt;
      padding-top: 12pt;
      border-top: 1pt solid #ccc;
      font-size: 10pt;
      color: #666;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="header-block">
    <div class="company-name">SINGH AUTOMATION LLC</div>
    <div class="company-info">
      CAGE: 86VF7 | UEI: GJ1DPYQ3X8K5<br>
      Kalamazoo, MI (HQ) | Irvine, CA (Sales)<br>
      albert@singhautomation.com | 786.344.8955
    </div>
  </div>
  
  <div class="proposal-title">${title}</div>
  <div class="solicitation">Solicitation: ${solicitation} | Agency: ${agency}</div>
  
  <div class="content">
    ${content.replace(/<strong style="color:#60a5fa[^"]*">/g, '<h2>').replace(/<\/strong>/g, '</h2>')}
  </div>
  
  <div class="footer">
    Singh Automation LLC | Confidential Proposal | Generated ${new Date().toLocaleDateString()}
  </div>
</body>
</html>`;

      // Create and download
      const blob = new Blob([wordContent], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Singh_Proposal_${(opp.title || 'Federal').replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30)}.doc`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      console.log('Word document exported');
    }
    
    function exportPDF() {
      const content = document.getElementById('editorContent').innerHTML;
      const oppData = localStorage.getItem('currentOpportunity');
      const opp = oppData ? JSON.parse(oppData) : {};
      
      const title = opp.title || 'Federal Proposal';
      const agency = opp.agency || opp.departmentName || 'Federal Agency';
      const solicitation = opp.noticeId || opp.id || '';
      
      // Create print-friendly HTML
      const printContent = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>${title} - Singh Automation Proposal</title>
  <style>
    @media print {
      @page { 
        size: letter; 
        margin: 0.75in; 
      }
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Times New Roman', Times, serif; 
      font-size: 12pt; 
      line-height: 1.6; 
      color: #000;
      background: #fff;
      padding: 0.5in;
    }
    .header-block {
      text-align: center;
      margin-bottom: 20pt;
      padding-bottom: 15pt;
      border-bottom: 3pt solid #1a365d;
    }
    .company-name {
      font-size: 20pt;
      font-weight: bold;
      color: #1a365d;
      letter-spacing: 1pt;
    }
    .company-tagline {
      font-size: 9pt;
      color: #666;
      margin-top: 4pt;
      font-style: italic;
    }
    .company-info {
      font-size: 9pt;
      color: #444;
      margin-top: 8pt;
    }
    .proposal-title {
      font-size: 16pt;
      font-weight: bold;
      margin: 20pt 0 8pt;
      color: #1a365d;
      text-align: center;
    }
    .solicitation {
      font-size: 10pt;
      color: #666;
      margin-bottom: 20pt;
      text-align: center;
    }
    .content {
      text-align: justify;
    }
    h1, h2, h3, strong { color: #1a365d; }
    h1 { 
      font-size: 14pt; 
      margin: 20pt 0 10pt; 
      padding-bottom: 4pt;
      border-bottom: 1pt solid #ddd; 
      text-transform: uppercase;
    }
    h2 { font-size: 12pt; margin: 16pt 0 8pt; }
    p { margin: 0 0 10pt; }
    ul, ol { margin: 8pt 0 12pt 20pt; }
    li { margin-bottom: 4pt; }
    .footer {
      margin-top: 30pt;
      padding-top: 10pt;
      border-top: 1pt solid #ccc;
      font-size: 9pt;
      color: #666;
      text-align: center;
    }
    .page-number {
      position: fixed;
      bottom: 0.5in;
      right: 0.75in;
      font-size: 9pt;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="header-block">
    <div class="company-name">SINGH AUTOMATION LLC</div>
    <div class="company-tagline">Driving Innovation Through Intelligent Automation</div>
    <div class="company-info">
      CAGE: 86VF7 | UEI: GJ1DPYQ3X8K5 | Small Business<br>
      HQ: Kalamazoo, MI | Sales: Irvine, CA<br>
      albert@singhautomation.com | 786.344.8955
    </div>
  </div>
  
  <div class="proposal-title">${title}</div>
  <div class="solicitation">
    Solicitation: ${solicitation}<br>
    Submitted to: ${agency}<br>
    Date: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
  </div>
  
  <div class="content">
    ${content
      .replace(/<strong style="color:#60a5fa[^"]*">/g, '<h1>')
      .replace(/<strong>/g, '<strong>')
      .replace(/<\/strong>/g, '</strong>')
      .replace(/---/g, '<hr style="border:none;border-top:1px solid #ddd;margin:15pt 0;">')
    }
  </div>
  
  <div class="footer">
    <strong>Singh Automation LLC</strong> | Confidential Business Proposal<br>
    CAGE: 86VF7 | UEI: GJ1DPYQ3X8K5 | NAICS: 333249, 333922, 541330, 541512, 541715, 238210
  </div>
</body>
</html>`;

      // Open in new window for printing
      const printWindow = window.open('', '_blank');
      printWindow.document.write(printContent);
      printWindow.document.close();
      
      // Wait for content to load then print
      printWindow.onload = function() {
        setTimeout(() => {
          printWindow.print();
        }, 250);
      };
      
      console.log('PDF export initiated (print dialog)');
    }
  </script>

</body>
</html>
